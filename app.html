<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventory Sell Assistant</title>
  <link rel="stylesheet" href="app.css" />
  <link rel="stylesheet" href="roi-module.css" />
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <h1 id="brandTitle">Inventory</h1>
        <p id="brandDescription">Парсинг інвентарю, трейдбан, ціни market buy/sell та продаж.</p>
      </div>

      <div class="module-switcher">
        <button id="inventoryModuleBtn" class="secondary active">Inventory</button>
        <button id="craftsModuleBtn" class="ghost">Крафти</button>
        <button id="roiModuleBtn" class="ghost">ROI</button>
        <button id="ratesModuleBtn" class="ghost">Курс</button>
      </div>

      <div class="language-switcher">
        <span id="languageLabel">Мова</span>
        <div class="button-row">
          <button id="langUkBtn" class="secondary">UA</button>
          <button id="langEnBtn" class="ghost">EN</button>
        </div>
      </div>

      <div class="sidebar-note">
        <h3 id="hintTitle">Підказка</h3>
        <p id="hintDescription">Масовий лістинг виконується з паузою 250ms між кожним sellitem.</p>
      </div>
      <div class="sidebar-note live-log-panel">
        <h3 id="liveTitle">Live</h3>
        <div id="liveLogList" class="live-log-list"></div>
      </div>
    </aside>

    <main class="content">
      <header class="section-title">
        <div>
          <h2 id="mainTitle">Steam Inventory Sell Assistant</h2>
          <p id="mainSubtitle">Зібрати інвентар → згрупувати/розгрупувати → перевірити ціну → виставити.</p>
        </div>
        <div class="status-pill" id="statusPill">Status: Idle</div>
      </header>

      <div id="inventoryModuleContent">
        <section class="panel">
          <div class="panel-header">
            <h3 id="controlsTitle">Керування</h3>
          </div>
          <div class="button-row wrap">
            <button id="parseInventoryBtn" class="primary">Спарсити інвентар</button>
            <button id="toggleGroupingBtn" class="secondary">Згрупувати</button>
            <button id="checkAllPricesBtn" class="secondary">Оновити ціни (всі)</button>
          </div>
          <label class="field" for="inventorySourceInput">
            <span id="inventorySourceLabel">Джерело інвентарю (свій SteamID / profiles URL / inventory URL)</span>
            <input
              id="inventorySourceInput"
              type="text"
              placeholder="https://steamcommunity.com/profiles/7656xxxxxxxxxxxxxx"
            />
          </label>
        </section>

        <section class="panel">
          <div class="section-header">
            <div class="inventory-title-wrap">
              <h3 id="inventoryTitle">Інвентар</h3>
              <span id="inventoryTotals" class="meta"></span>
            </div>
            <div class="inventory-tools">
              <input id="inventorySearchInput" type="search" placeholder="Пошук по назві..." />
              <label for="inventorySortColumn" id="sortColumnLabel">Стовпець</label>
              <select id="inventorySortColumn"></select>
              <label for="inventorySortDirection" id="sortDirectionLabel">Порядок</label>
              <select id="inventorySortDirection">
                <option value="asc">А-Я / 0-9</option>
                <option value="desc">Я-А / 9-0</option>
              </select>
              <span class="meta" id="inventoryMeta">0 рядків</span>
            </div>
          </div>
          <div class="section-body">
            <table class="inventory-table">
              <thead id="inventoryTableHead"></thead>
              <tbody id="inventoryTableBody"></tbody>
            </table>
          </div>
        </section>

        <section class="panel logs-panel">
          <div class="panel-header"><h3 id="logsTitle">Логи</h3></div>
          <div id="logList" class="log-list"></div>
        </section>
      </div>

      <div id="ratesModuleContent" class="hidden">
        <section class="panel">
          <h3 id="ratesTitle">Курс валют (Steam)</h3>
          <p id="ratesSubtitle" class="meta">Порівняння цін по валютах через itemordershistogram. розрахунок різниці купівлі турнірних капсул з магазину кс2, доллар як 0</p>
          <div class="button-row wrap rates-controls">
            <label class="field rates-field">
              item_nameid
              <input id="ratesItemNameIdInput" type="number" min="1" step="1" value="1" />
            </label>
            <label class="field rates-field">
              country
              <input id="ratesCountryInput" type="text" value="UA" />
            </label>
            <label class="field rates-field">
              language
              <input id="ratesLanguageInput" type="text" value="ukrainian" />
            </label>
            <label class="field rates-field">
              maxConcurrency
              <input id="ratesConcurrencyInput" type="number" min="1" max="10" step="1" value="1" />
            </label>
          </div>
          <div class="button-row wrap">
            <button id="ratesRunBtn" class="primary" type="button">Запустити курс</button>
            <span id="ratesStatus" class="meta">Очікування запуску…</span>
          </div>
        </section>

        <section class="panel">
          <h3 id="ratesResultTitle">Результат</h3>
          <div class="rates-grid">
            <div>
              <h4 id="ratesTable1Title">Steam rates (1 USD = X CUR)</h4>
              <div class="section-body rates-table-wrap">
                <table class="inventory-table rates-table" id="ratesTable"></table>
              </div>
            </div>
            <div>
              <h4 id="ratesTable2Title">Local prices → USD</h4>
              <div class="section-body rates-table-wrap">
                <table class="inventory-table rates-table" id="ratesCompareTable"></table>
              </div>
            </div>
          </div>
        </section>
      </div>

      <div id="craftsModuleContent" class="hidden">
        <section class="panel">
          <div class="panel-header">
            <h3 id="craftsTitle">Крафти</h3>
          </div>
          <p id="craftsSubtitle" class="meta">Список предметів з інвентарю, в яких знайдено float.</p>
          <label class="field" for="craftsInventorySourceInput">
            <span id="craftsInventorySourceLabel">Джерело інвентарю (SteamID / profiles URL / inventory URL)</span>
            <input
              id="craftsInventorySourceInput"
              type="text"
              placeholder="https://steamcommunity.com/profiles/7656xxxxxxxxxxxxxx"
            />
          </label>
          <div class="button-row wrap">
            <button id="craftsRefreshBtn" class="secondary" type="button">Оновити список</button>
            <button id="checkCraftsBtn" class="primary" type="button">Перевірити крафти</button>
            <button id="checkCraftPricesBtn" class="secondary" type="button">Перевірити ціни</button>
            <button id="checkCraftStepUpPricesBtn" class="secondary" type="button">Перевірити ціни +1 крок</button>
            <span id="craftsMeta" class="meta">0 предметів</span>
          </div>
        </section>

        <section class="panel">
          <div class="panel-header">
            <h3 id="craftsItemsTitle">Craft items</h3>
            <button id="exportCraftsItemsCsvBtn" class="ghost small" type="button">CSV</button>
          </div>
          <div class="section-body rates-table-wrap">
            <table class="inventory-table" id="craftsTable"></table>
          </div>
        </section>

        <section class="panel">
          <div class="panel-header"><h3 id="craftsResultsTitle">Найкращі плюсові крафти</h3><button id="exportCraftsResultsCsvBtn" class="ghost small" type="button">CSV</button></div>
          <div class="section-body rates-table-wrap">
            <table class="inventory-table" id="craftsResultsTable"></table>
          </div>
        </section>

        <section class="panel">
          <div class="panel-header"><h3 id="craftsVariantsTitle">Можливі крафти і результати</h3><button id="exportCraftsVariantsCsvBtn" class="ghost small" type="button">CSV</button></div>
          <div class="section-body rates-table-wrap">
            <table class="inventory-table" id="craftsVariantsTable"></table>
          </div>
        </section>

        <section class="panel">
          <div class="panel-header"><h3 id="craftsInterestingTitle">Крафти на цікаві числа</h3><button id="exportCraftsInterestingCsvBtn" class="ghost small" type="button">CSV</button></div>
          <div class="section-body rates-table-wrap">
            <table class="inventory-table" id="craftsInterestingTable"></table>
          </div>
        </section>

        <section class="panel">
          <div class="panel-header"><h3 id="craftsStepUpTitle">Підрахунок апгрейду якості (+1 крок)</h3></div>
          <div class="section-body rates-table-wrap">
            <table class="inventory-table" id="craftsStepUpTable"></table>
          </div>
        </section>
      </div>

      <div id="roiModuleContent" class="hidden">
        <section class="panel roi-panel-header">
          <h3>Турнірні капсули – наліпки та ціни</h3>
          <p>
            Натисни “Старт”, щоб пройти всі сторінки з затримкою 400 мс і зібрати назви наліпок та ціни.
          </p>
          <div class="controls">
            <button id="start-button" class="primary" type="button">Старт</button>
            <button id="base-button" class="secondary" type="button">Зібрати базу для ROI</button>
            <span id="status" class="status">Очікування запуску…</span>
          </div>
          <div class="tournaments">
            <p>Оберіть один турнір для парсингу:</p>
            <div class="tournament-list">
              <label class="option"><input type="radio" id="tournament-bud2025" name="tournament" checked /> Budapest 2025</label>
              <label class="option"><input type="radio" id="tournament-rmr2020" name="tournament" /> RMR 2020</label>
              <label class="option"><input type="radio" id="tournament-antwerp2022" name="tournament" /> Antwerp 2022</label>
              <label class="option"><input type="radio" id="tournament-aus2025" name="tournament" /> Austin 2025</label>
              <label class="option"><input type="radio" id="tournament-cph2024" name="tournament" /> Copenhagen 2024</label>
              <label class="option"><input type="radio" id="tournament-paris2023" name="tournament" /> Paris 2023</label>
              <label class="option"><input type="radio" id="tournament-stockh2021" name="tournament" /> Stockholm 2021</label>
              <label class="option"><input type="radio" id="tournament-rio2022" name="tournament" /> Rio 2022</label>
              <label class="option"><input type="radio" id="tournament-sha2024" name="tournament" /> Shanghai 2024</label>
            </div>
          </div>
          <label class="option exclude-option">
            <input type="checkbox" id="exclude-003" />
            виключити наліпки до ціни
            <input type="number" id="exclude-price-threshold" min="0" step="0.01" value="0.03" />
            (в валюті акаунта)
          </label>
          <div id="cookie-status" class="cookie-status"></div>
        </section>

        <section class="panel results" id="results">
          <article class="card" data-capsule="contenders">
            <h2>Contenders</h2>
            <div class="roi" id="contenders-roi">
              <p class="roi-line">ROI: <span class="roi-value">—</span></p>
              <p class="roi-line">База: <span class="roi-compare">—</span></p>
            </div>
            <div class="category"><h3><span id="contenders-remarkable-label">Remarkable</span> (1/6,2)</h3><ul class="items" id="contenders-remarkable-list"></ul></div>
            <div class="category"><h3><span id="contenders-exotic-label">Exotic</span> (1/32)</h3><ul class="items" id="contenders-exotic-list"></ul></div>
            <div class="category"><h3><span id="contenders-gold-label">Gold</span> (1/156)</h3><ul class="items" id="contenders-gold-list"></ul></div>
          </article>
          <article class="card" data-capsule="challengers">
            <h2>Challengers</h2>
            <div class="roi" id="challengers-roi">
              <p class="roi-line">ROI: <span class="roi-value">—</span></p>
              <p class="roi-line">База: <span class="roi-compare">—</span></p>
            </div>
            <div class="category"><h3><span id="challengers-remarkable-label">Remarkable</span> (1/6,2)</h3><ul class="items" id="challengers-remarkable-list"></ul></div>
            <div class="category"><h3><span id="challengers-exotic-label">Exotic</span> (1/32)</h3><ul class="items" id="challengers-exotic-list"></ul></div>
            <div class="category"><h3><span id="challengers-gold-label">Gold</span> (1/156)</h3><ul class="items" id="challengers-gold-list"></ul></div>
          </article>
          <article class="card" data-capsule="legends">
            <h2>Legends</h2>
            <div class="roi" id="legends-roi">
              <p class="roi-line">ROI: <span class="roi-value">—</span></p>
              <p class="roi-line">База: <span class="roi-compare">—</span></p>
            </div>
            <div class="category"><h3><span id="legends-remarkable-label">Remarkable</span> (1/6,2)</h3><ul class="items" id="legends-remarkable-list"></ul></div>
            <div class="category"><h3><span id="legends-exotic-label">Exotic</span> (1/32)</h3><ul class="items" id="legends-exotic-list"></ul></div>
            <div class="category"><h3><span id="legends-gold-label">Gold</span> (1/156)</h3><ul class="items" id="legends-gold-list"></ul></div>
          </article>
        </section>

        <section class="panel log-section">
          <h3>Логування ROI</h3>
          <pre id="log-output" class="log-output"></pre>
        </section>

        <section class="panel theory-section card">
          <h3>Теоретично відкритих капсул подобово</h3>
          <p class="theory-note">
            Дані базуються на основі середньо добового продажу "як є", нажаль
            порахувати точно не вийде але наближені цифри і розуміння ситуації воно дасть.
          </p>
          <div class="controls">
            <button id="theory-button" class="secondary" type="button">Порахувати по історії продажів</button>
            <span id="theory-status" class="status">Очікування запуску…</span>
          </div>
          <div id="theory-output" class="theory-output">Ще немає розрахунку.</div>
        </section>


        <section class="panel theory-section card">
          <h3>Теоретично відкритих капсул по турнірах (2021–2025)</h3>
          <p class="theory-note">
            Аналіз по stickers_clean.json для капсул Contenders/Challengers/Legends без Autograph.
          </p>
          <div class="theory-filters">
            <div class="option theory-select-wrap">
              <span>Турніри:</span>
              <div id="theory-tournament-list" class="theory-tournament-list"></div>
            </div>
            <label class="option theory-range-wrap" for="theory-day-start">
              Діапазон днів від старту історії:
              <input type="number" id="theory-day-start" min="0" step="1" value="0" />
              —
              <input type="number" id="theory-day-end" min="1" step="1" value="180" />
            </label>
          </div>
          <div class="controls">
            <button id="theory-tournament-button" class="secondary" type="button">Порахувати вибраний турнір</button>
            <span id="theory-tournament-status" class="status">Очікування запуску…</span>
          </div>
          <div id="theory-tournament-output" class="theory-output">Ще немає розрахунку.</div>
        </section>
      </div>
    </main>
  </div>

  <div id="priceHistoryModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-overlay" data-close="true"></div>
    <div class="modal-card">
      <div class="modal-header">
        <div>
          <h3 id="priceHistoryTitle">Історія предмета</h3>
          <p id="priceHistorySubtitle">Останні 30 днів</p>
        </div>
        <button id="closePriceHistory" class="icon-btn" type="button" aria-label="Закрити">✕</button>
      </div>
      <div class="modal-controls">
        <div class="toggle-group">
          <button class="toggle-button active" type="button" data-history-range="recent">Останні 30 днів</button>
          <button class="toggle-button" type="button" data-history-range="full">Історичні дані</button>
        </div>
        <button id="resetHistoryZoom" class="ghost small" type="button">Скинути масштаб</button>
        <label class="filter-toggle">
          <input type="checkbox" id="noiseFilterToggle" />
          Відсікти шум
        </label>
        <div class="chart-legend">
          <span class="legend-item"><span class="legend-swatch line"></span>Ціна</span>
          <span class="legend-item"><span class="legend-swatch bars"></span>Кількість продаж</span>
        </div>
      </div>
      <div class="modal-body">
        <div class="chart-shell">
          <canvas id="priceHistoryChart" class="history-chart" height="320"></canvas>
        </div>
        <div id="priceHistoryStatus" class="chart-status"></div>
        <div class="history-insights">
          <div class="insight-grid">
            <div class="insight-card">
              <h4>Топ 3 ціни (найбільше угод)</h4>
              <ol id="historyTopPrices" class="insight-list"></ol>
            </div>
            <div class="insight-card">
              <h4>Продано за період</h4>
              <div id="historyTotalVolume" class="insight-value">--</div>
              <div id="historyRangeLabel" class="insight-sub">--</div>
            </div>
          </div>
          <div class="insight-card">
            <h4>Оцінка часу продажу</h4>
            <div class="forecast-grid">
              <label class="field">
                <span>Кількість позицій</span>
                <input id="forecastQuantity" type="number" min="1" step="1" placeholder="8000" />
              </label>
              <label class="field">
                <span>Історія за N днів</span>
                <input id="forecastDays" type="number" min="1" step="1" value="30" />
              </label>
            </div>
            <div id="forecastResult" class="forecast-result">Введіть кількість і N днів для оцінки.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="crafts-calculator.js?v=2026-02-20-1"></script>
  <script src="app.js?v=2026-02-20-1"></script>
  <script src="roi-fx-module.js?v=2026-02-15-2"></script>
  <script src="roi-module.js?v=2026-02-13-1"></script>
  <script src="roi-fx-module.js?v=2026-02-15-2"></script>
</body>
</html>
